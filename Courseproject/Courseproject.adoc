:imagesdir: Images
:figure-caption: Рисунок
:table-caption: Таблица
= Курсовой проект
:toc:
:toc-title: Оглавление:

Тема работы: *Разработка метеостанции с передачей параметров по беспроводному интерфейсу*

Чепульская О.С., Яковенко А.Д. КЭ-413 +

= Задание на курсовой проект 

Для разработки должна использоваться отладочная плата  *XNUCLEO-F411RE*. +

Питание платы должно быть автономным и подаваться с солнечный батарей. +

Программное обеспечение измерение должно измерять давление, влажность и температуру и рассчитывать точку росы:

* Период измерения должен быть 100 ms.
* Для измерения давления, влажности и температуры должен использоваться датчик BME280
* Общение с датчиком должно осуществляться по интерфейсу SPIx (где х - любой не равный 1,2,3)
* Точка росы должна считаться на основе текущих показаний влажности и давления

Передача значений по беспроводному интерфейсу должна осуществляться через модуль BlueTooth Bee *HC-06*

* Формат вывода: +
"Давление:" XXX.XX +
"Влажность:" XXX.XX +
"Температура:" XXX.XX +
"Точка росы":" XXX.XX +

* Для подключения модуля BlueTooth должна использоваться плата *Accessories* *Shield* или I/O Expansion Shield
* Общение с платной модуля BlueTooth должна осуществляться через USART2
* Период вывода информации через BlueTooth модуль должен быть 1 секунда.

Архитектура должна быть представлена в виде UML диаграмм в пакете Star UML.

Приложение должно быть написано на языке С++ с использование компилятора ARM 9.10

При разработке должна использоваться Операционная Система Реального Времени FreeRTOS и С++ обертка над ней.


= Анализ требований к разработке


== Для разработки должна использоваться отладочная плата XNUCLEO-F411RE

XNUCLEO-F411RE – это отладочная плата от компании Waveshare с поддержкой Arduino, которая позволит изучить возможности микроконтроллера STM32F411RET6 на базе ядра Cortex-M3.

.Вид платы XNUCLEO-F411RE.
image::kr1.png[300, 300]


== Питание платы должно быть автономным и подаваться с солнечный батарей

Питание будет подаваться с модуля управления солнечной энергией, для панели солнечных батарей 6V~24V. 
Этот модуль управления солнечной энергией может заряжать аккумуляторную литиевую батарею 3.7 V через солнечную панель или USB-соединение и обеспечивает регулируемый выход 5V/1A.

Характеристики:

* Напряжение солнечной панели (SOLAR IN): 6V ~ 24V;
* Зарядные устройства: Солнечная панель, адаптер питания, USB;
* USB-интерфейс зарядки: Micro USB: 5V/1A;
* Внутренняя литий-батарея: 3.7 V 14500 Li-battery;
* Входное напряжение USB: 5V (интерфейс Micro USB);
* Выход 5V: 5V / 1A (USB OUT, GPIO);
* Защита от напряжения отключения заряда: 4.2 V ± 1％;
* Напряжение защиты от перегрузки: 2.9V ± 1％;
* Эффективность заряда солнечной панели: 78%;
* Эффективность зарядки USB: 82%;
* Максимальный ток покоя: <2мА;
* Рабочая температура: -40℃ ~ 85℃.

.Модуль управления солнечной энергией
image::kr2.png[250, 250]

.Способ подключения солнечной батареи
image::kr3.png[500, 500]

== Программное обеспечение измерение должно измерять давление, влажность и температуру и рассчитывать точку росы.


*Период измерения должен быть 100 ms.*

=== Для измерения давления, влажности и температуры должен использоваться датчик BME280

*BME280* – высокоточный метеодатчик, измеряющий такие параметры микроклимата как температура, влажность и атмосферное давление. +
В зависимости от модуля может подключаться к I2C и SPI шинами микроконтроллера и работать от 3-5V, если на плате есть стабилизатор, или 3V, если его нет. +
Данный модуль работает по двухпроводному интерфейсу I2C, адрес по умолчанию 0x76, но есть возможность изменить на адрес 0x77. Модуль подключается на шину I2C и питание, как и любой другой модуль такого типа. +

Примеры библиотек для работы с датчиком:

* Adafruit BME280 (для работы также нужна Adafruit Sensor) – самая известная библиотека для работы с BME280. Часть настроек доступна только при ручном редактировании библиотеки.
* GyverBME280 –Также поддерживает датчики BMP280

Благодаря сверхмалому форм-фактору, низкому энергопотреблению, высокой точности и стабильности датчик окружающей среды BME280 подходит для таких применений, как мониторинг окружающей среды, прогноз погоды.

*Управление питанием*. BME280 имеет два отдельных вывода источника питания:

* Vdd является основным источником питания для всех внутренних аналоговых и цифровых функциональных блоков;
* Vddio - это отдельный вывод источника питания, используемый для питания цифрового интерфейса.

Встроенный генератор сброса питания (POR), он сбрасывает логическую часть и значения регистра после обоих Vdd и Vddio достигают своих минимальных уровней. Нет никаких ограничений на наклон и последовательность повышения уровней Vdd и Vddio.

*Режимы датчика*. BME280 предлагает три режима работы датчика: 

* Sleep mode: не работает, доступны все регистры, самая низкая мощность, выбирается после запуска;
* Forced mode: выполнит одно измерение, сохранит результаты и вернется в спящий режим;
* Normal mode: непрерывный цикл измерений и периоды бездействия.



=== Общение с датчиком должно осуществляться по интерфейсу SPIx (где х - любой не равный 1,2,3)

Последовательный периферийный интерфейс (SPI) обеспечивает полудуплексную/полнодуплексную синхронную последовательную связь с внешними устройствами. Интерфейс может быть сконфигурирован как ведущий, и в этом случае он обеспечивает синхронизацию связи (SCK) с внешним подчиненным устройством. + 
Интерфейс также способен работать в конфигурации multimaster. Он может использоваться для различных целей, включая симплексную синхронную передачу по двум линиям с возможной двунаправленной линией передачи данных или надежную связь с использованием проверки CRC. +
Интерфейс SPI имеет два режима: 4-проводной и 3-проводной. Протокол одинаков для обоих.









